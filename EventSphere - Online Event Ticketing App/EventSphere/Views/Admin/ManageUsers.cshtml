@model IEnumerable<EventSphere.Models.User>
@{
    ViewBag.Title = "Manage Users";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Header -->
<section class="bg-primary text-white text-center py-5 mb-4">
    <div class="container">
        <h1 class="fw-bold mb-2">Manage Users</h1>
        <p class="lead mb-0">View, search, and manage user accounts and roles</p>
    </div>
</section>

<!-- Filter & Search Section -->
<section class="container mb-4">
    <div class="card border-0 shadow-sm rounded-3">
        <div class="card-body">
            <div class="row g-3 align-items-center">
                <div class="col-md-4">
                    <input type="text" id="searchUser" class="form-control" placeholder="Search by name or email...">
                </div>
                <div class="col-md-4">
                    <select id="roleFilter" class="form-select">
                        <option value="">All Roles</option>
                        <option value="Admin">Admin</option>
                        <option value="Organizer">Organizer</option>
                        <option value="Customer">Customer</option>
                    </select>
                </div>
                <div class="col-md-4 text-end">
                    <a href="@Url.Action("Create", "Account")" class="btn btn-success">
                        <i class="bi bi-person-plus me-2"></i>Add New User
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Users Table -->
<section class="container mb-5">
    <div class="card border-0 shadow-sm rounded-3">
        <div class="card-header bg-light py-3">
            <h5 class="mb-0"><i class="bi bi-people-fill text-primary me-2"></i>All Users</h5>
        </div>

        <div class="card-body p-0">
            @if (Model != null && Model.Any())
             {
                <div class="table-responsive">
                    <table class="table table-striped align-middle mb-0" id="usersTable">
                        <thead class="table-light">
                            <tr>
                                <th>User ID</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Registered On</th>
                                <th>Status</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in Model)
                             {
                                <tr data-role="@user.Role.ToLower()" data-name="@user.FullName.ToLower()" data-email="@user.Email.ToLower()">
                                    <td>@user.UserID</td>
                                    <td>@user.FullName</td>
                                    <td>@user.Email</td>
                                    <td>
                                        @if (user.Role == "Admin")
                                         {
                                            <span class="badge bg-danger">Admin</span>
                                         }
                                        else if (user.Role == "Organizer")
                                        {
                                            <span class="badge bg-info text-dark">Organizer</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">Customer</span>
                                        }
                                    </td>
                                    <td>
                                        @(user.CreatedAt.HasValue
                                            ? user.CreatedAt.Value.ToString("dd MMM yyyy")
                                            : "N/A")
                                    </td>
                                    <td>
                                        @if (user.AccountStatus != null && user.AccountStatus.Equals("Active", StringComparison.OrdinalIgnoreCase))
                                        {
                                            <span class="badge bg-success">Active</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">Inactive</span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        <a href="@Url.Action("EditUser", "Admin", new { id = user.UserID })" class="btn btn-sm btn-outline-primary me-1">
                                            <i class="bi bi-pencil-square"></i>
                                        </a>
                                        <a href="@Url.Action("DeleteUser", "Admin", new { id = user.UserID })"
                                           class="btn btn-sm btn-outline-danger"
                                           onclick="return confirm('Are you sure you want to delete this user?');">
                                            <i class="bi bi-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                             }
                        </tbody>
                    </table>
                </div>
             }
            else
            {
                <div class="text-center py-5">
                    <i class="bi bi-person-x display-4 text-muted"></i>
                    <p class="text-muted mt-3 mb-0">No users found.</p>
                </div>
            }
        </div>
    </div>
</section>

<!-- Scripts -->
@section scripts {
    <script>
        const searchUser = document.getElementById("searchUser");
        const roleFilter = document.getElementById("roleFilter");
        const rows = document.querySelectorAll("#usersTable tbody tr");

        function filterUsers() {
            const searchValue = searchUser.value.toLowerCase();
            const selectedRole = roleFilter.value.toLowerCase();

            rows.forEach(row => {
                const name = row.getAttribute("data-name");
                const email = row.getAttribute("data-email");
                const role = row.getAttribute("data-role");

                const matchesSearch = name.includes(searchValue) || email.includes(searchValue);
                const matchesRole = !selectedRole || role === selectedRole;

                row.style.display = (matchesSearch && matchesRole) ? "" : "none";
            });
        }

        searchUser.addEventListener("input", filterUsers);
        roleFilter.addEventListener("change", filterUsers);
    </script>
}

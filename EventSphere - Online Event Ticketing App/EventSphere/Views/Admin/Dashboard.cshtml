@model IEnumerable<EventSphere.Models.Booking>
@{
    ViewBag.Title = "Admin Dashboard";
    Layout = ViewBag.LayoutPath;
}

<!-- Custom Styles -->
<style>
    .dashboard-card {
        border: none;
        border-radius: 1rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        overflow: hidden;
    }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        position: relative;
        overflow: hidden;
    }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.1);
            transform: rotate(30deg);
        }

        .stat-card .icon-wrapper {
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

    .progress-ring {
        width: 80px;
        height: 80px;
    }

    .progress-ring-circle {
        transition: stroke-dashoffset 0.35s;
        transform: rotate(-90deg);
        transform-origin: 50% 50%;
    }

    .quick-action-card {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 1rem;
        padding: 2rem;
        text-align: center;
        transition: all 0.3s ease;
        height: 100%;
    }

        .quick-action-card:hover {
            border-color: #007bff;
            background: #f8f9ff;
        }

    .metric-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
    }

    .chart-container {
        background: white;
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    .recent-activity-item {
        border-left: 3px solid #007bff;
        padding-left: 1rem;
        margin-bottom: 1rem;
    }

    .trend-indicator {
        font-size: 0.875rem;
        font-weight: 600;
    }

    .trend-up {
        color: #28a745;
    }

    .trend-down {
        color: #dc3545;
    }
</style>

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 fw-bold text-primary mb-1">Admin Dashboard</h1>
                    <p class="text-muted mb-0">Welcome back! Here's what's happening with your events today.</p>
                </div>
                <div class="d-flex gap-2">
                    <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-calendar me-2"></i>Last 30 Days
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Last 7 Days</a></li>
                            <li><a class="dropdown-item" href="#">Last 30 Days</a></li>
                            <li><a class="dropdown-item" href="#">Last 90 Days</a></li>
                            <li><a class="dropdown-item" href="#">This Year</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="card dashboard-card stat-card text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="card-title text-white-50 mb-2">TOTAL USERS</h6>
                            <h2 class="fw-bold mb-1">@ViewBag.TotalUsers</h2>
                            <span class="trend-indicator trend-up">
                                <i class="bi bi-arrow-up-right me-1"></i>12.5%
                            </span>
                        </div>
                        <div class="icon-wrapper">
                            <i class="bi bi-people-fill fs-3"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card dashboard-card stat-card text-white" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="card-title text-white-50 mb-2">TOTAL EVENTS</h6>
                            <h2 class="fw-bold mb-1">@ViewBag.TotalEvents</h2>
                            <span class="trend-indicator trend-up">
                                <i class="bi bi-arrow-up-right me-1"></i>8.2%
                            </span>
                        </div>
                        <div class="icon-wrapper">
                            <i class="bi bi-calendar-event fs-3"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card dashboard-card stat-card text-white" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="card-title text-white-50 mb-2">TOTAL BOOKINGS</h6>
                            <h2 class="fw-bold mb-1">@ViewBag.TotalBookings</h2>
                            <span class="trend-indicator trend-up">
                                <i class="bi bi-arrow-up-right me-1"></i>15.3%
                            </span>
                        </div>
                        <div class="icon-wrapper">
                            <i class="bi bi-ticket-perforated fs-3"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card dashboard-card stat-card text-white" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="card-title text-white-50 mb-2">TOTAL REVENUE</h6>
                            <h2 class="fw-bold mb-1">LKR @ViewBag.TotalRevenue.ToString("N2")</h2>
                            <span class="trend-indicator trend-up">
                                <i class="bi bi-arrow-up-right me-1"></i>22.8%
                            </span>
                        </div>
                        <div class="icon-wrapper">
                            <i class="bi bi-currency-dollar fs-3"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Recent Bookings & Activity -->
        <div class="col-xl-8">
            <div class="row g-4">
                <!-- Recent Bookings -->
                <div class="col-12">
                    <div class="card dashboard-card">
                        <div class="card-header bg-transparent border-0 py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0 fw-bold">
                                    <i class="bi bi-clock-history text-primary me-2"></i>Recent Bookings
                                </h5>
                                <a href="@Url.Action("ManageBookings", "Admin")" class="btn btn-sm btn-outline-primary">
                                    View All <i class="bi bi-arrow-right ms-1"></i>
                                </a>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            @if (Model != null && Model.Any())
                            {
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="ps-4">Booking ID</th>
                                                <th>Event</th>
                                                <th>Customer</th>
                                                <th>Tickets</th>
                                                <th>Amount</th>
                                                <th>Date</th>
                                                <th class="pe-4">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var booking in Model.Take(6))
                                            {
                                                <tr>
                                                    <td class="ps-4">
                                                        <strong class="text-primary">#@booking.BookingID</strong>
                                                    </td>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <div class="bg-primary bg-opacity-10 rounded p-2 me-3">
                                                                <i class="bi bi-calendar-event text-primary"></i>
                                                            </div>
                                                            <div>
                                                                <div class="fw-semibold">@booking.Event.Title</div>
                                                                <small class="text-muted">@booking.Event.Venue.VenueName</small>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="fw-semibold">@booking.User.FullName</div>
                                                        <small class="text-muted">@booking.User.Email</small>
                                                    </td>
                                                    <td>
                                                        <span class="badge bg-light text-dark border">@booking.Quantity</span>
                                                    </td>
                                                    <td>
                                                        <strong class="text-success">LKR @booking.TotalAmount.ToString("N2")</strong>
                                                    </td>
                                                    <td>
                                                        <small class="text-muted">
                                                            @(booking.BookingDate.HasValue ? booking.BookingDate.Value.ToString("dd MMM yy") : "N/A")
                                                        </small>
                                                    </td>
                                                    <td class="pe-4">
                                                        @if (booking.PaymentStatus == "Completed")
                                                        {
                                                            <span class="badge bg-opacity-20 text-success border border-success">
                                                                <i class="bi bi-check-circle me-1"></i>Completed
                                                            </span>
                                                        }
                                                        else if (booking.PaymentStatus == "Pending")
                                                        {
                                                            <span class="badge bg-opacity-20 text-warning border border-warning">
                                                                <i class="bi bi-clock me-1"></i>Pending
                                                            </span>
                                                        }
                                                        else
                                                        {
                                                            <span class="badge bg-danger bg-opacity-20 text-danger border border-danger">
                                                                <i class="bi bi-x-circle me-1"></i>Failed
                                                            </span>
                                                        }
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                            else
                            {
                                <div class="text-center py-5">
                                    <i class="bi bi-receipt display-4 text-muted mb-3"></i>
                                    <h5 class="text-muted">No Recent Bookings</h5>
                                    <p class="text-muted mb-0">New bookings will appear here</p>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="col-md-6">
                    <div class="card dashboard-card">
                        <div class="card-body">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-graph-up text-success me-2"></i>Booking Trends
                            </h6>
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="text-muted">This Month</span>
                                <span class="badge bg-success">+15%</span>
                            </div>
                            <!-- Simple chart placeholder -->
                            <div class="bg-light rounded p-3 text-center">
                                <div class="text-muted small">Booking Analytics Chart</div>
                                <div class="mt-2">
                                    <canvas id="bookingChart" height="100"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card dashboard-card">
                        <div class="card-body">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-activity text-primary me-2"></i>System Health
                            </h6>
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="mb-2">
                                        <i class="bi bi-server text-success fs-4"></i>
                                    </div>
                                    <div class="fw-bold">Online</div>
                                    <small class="text-muted">Server</small>
                                </div>
                                <div class="col-4">
                                    <div class="mb-2">
                                        <i class="bi bi-database text-warning fs-4"></i>
                                    </div>
                                    <div class="fw-bold">98%</div>
                                    <small class="text-muted">Storage</small>
                                </div>
                                <div class="col-4">
                                    <div class="mb-2">
                                        <i class="bi bi-lightning-charge text-info fs-4"></i>
                                    </div>
                                    <div class="fw-bold">0.2s</div>
                                    <small class="text-muted">Response</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar - Quick Actions & Recent Activity -->
        <div class="col-xl-4">
            <!-- Quick Actions -->
            <div class="card dashboard-card mb-4">
                <div class="card-header bg-transparent border-0 py-3">
                    <h5 class="mb-0 fw-bold">
                        <i class="bi bi-lightning text-warning me-2"></i>Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-6">
                            <a href="@Url.Action("ManageUsers", "Admin")" class="quick-action-card text-decoration-none d-block">
                                <div class="bg-primary bg-opacity-10 rounded-circle p-3 mx-auto mb-3" style="width: 60px; height: 60px;">
                                    <i class="bi bi-people-fill text-primary fs-5"></i>
                                </div>
                                <h6 class="fw-bold text-dark mb-1">Manage Users</h6>
                                <small class="text-muted">View all users</small>
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="@Url.Action("ManageEvents", "Admin")" class="quick-action-card text-decoration-none d-block">
                                <div class="bg-success bg-opacity-10 rounded-circle p-3 mx-auto mb-3" style="width: 60px; height: 60px;">
                                    <i class="bi bi-calendar-event text-success fs-5"></i>
                                </div>
                                <h6 class="fw-bold text-dark mb-1">Manage Events</h6>
                                <small class="text-muted">Create & edit</small>
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="@Url.Action("ManageBookings", "Admin")" class="quick-action-card text-decoration-none d-block">
                                <div class="bg-warning bg-opacity-10 rounded-circle p-3 mx-auto mb-3" style="width: 60px; height: 60px;">
                                    <i class="bi bi-ticket-perforated text-warning fs-5"></i>
                                </div>
                                <h6 class="fw-bold text-dark mb-1">Bookings</h6>
                                <small class="text-muted">Manage all</small>
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="@Url.Action("Reports", "Admin")" class="quick-action-card text-decoration-none d-block">
                                <div class="bg-danger bg-opacity-10 rounded-circle p-3 mx-auto mb-3" style="width: 60px; height: 60px;">
                                    <i class="bi bi-graph-up text-danger fs-5"></i>
                                </div>
                                <h6 class="fw-bold text-dark mb-1">Reports</h6>
                                <small class="text-muted">View analytics</small>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Simple booking chart
            const ctx = document.getElementById('bookingChart').getContext('2d');
            const bookingChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Bookings',
                        data: [12, 19, 15, 25, 22, 30, 28],
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false
                            },
                            ticks: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Add animation to cards on load
            const cards = document.querySelectorAll('.dashboard-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';

                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
}
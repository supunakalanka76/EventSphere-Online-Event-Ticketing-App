@using EventSphere.Helpers
@{
    ViewBag.Title = "Home";
    Layout = ViewBag.LayoutPath;

    var isLoggedIn = SessionHelper.IsLoggedIn();
    var userRole = SessionHelper.GetUserRole();
}

<!-- Add SweetAlert CSS and JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Custom CSS for additional styling -->
<style>
    /* Custom styles for enhanced appearance */
    .hero-section {
        position: relative;
        overflow: hidden;
    }

    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: 1;
    }

    .hero-content {
        position: relative;
        z-index: 2;
    }

    .card-hover {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15) !important;
    }

    .feature-icon {
        transition: transform 0.3s ease;
    }

    .feature-icon:hover {
        transform: scale(1.1);
    }

    .btn-animated {
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .btn-animated:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .fade-in {
        animation: fadeIn 1s ease-in;
    }

    @@keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .pulse {
        animation: pulse 2s infinite;
    }

    @@keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
</style>

<!-- Hero Section -->
<section class="hero-section text-white text-center py-5" style="
    background-image: url('/Content/Images/hero-bg.jpg');
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;">
    <div class="container py-5 hero-content">
        <div class="fade-in">
            <h1 class="display-4 fw-bold mb-3">Welcome to EventSphere 🎉</h1>
            <p class="lead mb-4">
                Discover, organize, and experience unforgettable events across Sri Lanka.
            </p>

            @if (!isLoggedIn)
            {
                <a href="@Url.Action("Register", "Account")" class="btn btn-primary btn-lg me-2 btn-animated pulse">Join Now</a>
                <a href="@Url.Action("Login", "Account")" class="btn btn-outline-light btn-lg btn-animated">Login</a>
            }
            else if (userRole.ToLower() == "organizer")
            {
                <a href="@Url.Action("Dashboard", "Organizer")" class="btn btn-success btn-lg me-2 btn-animated">Manage My Events</a>
            }
            else if (userRole.ToLower() == "admin")
            {
                <a href="@Url.Action("Dashboard", "Admin")" class="btn btn-warning btn-lg me-2 btn-animated">Admin Dashboard</a>
            }
            else
            {
                <a href="@Url.Action("Index", "Event")" class="btn btn-primary btn-lg me-2 btn-animated">Explore Events</a>
                <a href="@Url.Action("Profile", "Account")" class="btn btn-outline-light btn-lg btn-animated">My Profile</a>
            }
        </div>
    </div>
</section>

<!-- Upcoming Events Section -->
<section class="container my-5">
    <div class="text-center mb-4 fade-in">
        <h2 class="fw-bold">Upcoming Events</h2>
        <p class="text-muted">Stay tuned for the latest happenings and unforgettable experiences!</p>
    </div>

    <div class="row g-4">
        @if (ViewBag.UpcomingEvents != null && ((IEnumerable<EventSphere.Models.Event>)ViewBag.UpcomingEvents).Any())
        {
            foreach (var ev in (IEnumerable<EventSphere.Models.Event>)ViewBag.UpcomingEvents)
            {
                <div class="col-md-4">
                    <div class="card h-100 shadow-sm border-0 card-hover">
                        <img src="@(!string.IsNullOrEmpty(ev.EventImage) ? ev.EventImage : "/Content/Events/default-event.png")"
                             class="card-img-top" alt="@ev.Title" style="height: 220px; object-fit: cover;" />
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title fw-bold">@ev.Title</h5>
                            <p class="text-muted mb-2">
                                <i class="bi bi-geo-alt"></i> @ev.Venue.VenueName, @ev.Venue.City <br />
                                <i class="bi bi-calendar-event"></i> @ev.StartDate.ToString("MMM dd, yyyy")
                            </p>
                            <p class="text-muted flex-grow-1">@(ev.Description.Length > 100 ? ev.Description.Substring(0, 100) + "..." : ev.Description)</p>
                            <a href="@Url.Action("Details", "Event", new { id = ev.EventID })" class="btn btn-primary mt-auto btn-animated">View Details</a>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-12 text-center py-5 fade-in">
                <i class="bi bi-calendar-x display-4 text-muted"></i>
                <h5 class="mt-3 text-muted">No upcoming events available.</h5>
            </div>
        }
    </div>

    <div class="text-center mt-5">
        <a href="@Url.Action("Index", "Event")" class="btn btn-outline-primary btn-lg btn-animated">
            <i class="bi bi-grid"></i> View All Events
        </a>
    </div>
</section>

<!-- About Platform Section -->
<section class="bg-light py-5 mt-5">
    <div class="container text-center">
        <h2 class="fw-bold mb-3">Why Choose EventSphere?</h2>
        <p class="text-muted mb-4">From concerts to conferences — plan, manage, and enjoy every event seamlessly.</p>

        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="feature-icon">
                    <i class="bi bi-calendar-event display-4 text-primary mb-3"></i>
                </div>
                <h5 class="fw-semibold">Easy Booking</h5>
                <p>Book tickets in just a few clicks and get instant e-tickets with QR codes.</p>
            </div>
            <div class="col-md-4 mb-4">
                <div class="feature-icon">
                    <i class="bi bi-people display-4 text-success mb-3"></i>
                </div>
                <h5 class="fw-semibold">For Organizers</h5>
                <p>Organize and manage your events with real-time tracking and reports.</p>
            </div>
            <div class="col-md-4 mb-4">
                <div class="feature-icon">
                    <i class="bi bi-shield-check display-4 text-warning mb-3"></i>
                </div>
                <h5 class="fw-semibold">Secure Payments</h5>
                <p>Trusted by users with safe and reliable payment gateways.</p>
            </div>
        </div>
    </div>
</section>

<!-- JavaScript for SweetAlert and animations -->
<script>

    // Function to handle event card clicks with SweetAlert
    function setupEventCardInteractions() {
        const eventCards = document.querySelectorAll('.card-hover');

        eventCards.forEach(card => {
            card.addEventListener('click', function(e) {
                if (e.target.tagName === 'A' || e.target.closest('a')) {
                    // Let the link work normally
                    return;
                }

                const title = this.querySelector('.card-title').textContent;

                Swal.fire({
                    title: title,
                    text: 'Would you like to view details for this event?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'View Details',
                    cancelButtonText: 'Maybe Later',
                    confirmButtonColor: '#0d6efd'
                }).then((result) => {
                    if (result.isConfirmed) {
                        const link = this.querySelector('a');
                        if (link) {
                            window.location.href = link.href;
                        }
                    }
                });
            });
        });
    }

    // Function to add scroll animations
    function setupScrollAnimations() {
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                }
            });
        }, observerOptions);

        // Observe all cards and sections
        document.querySelectorAll('.card, section').forEach(el => {
            observer.observe(el);
        });
    }

    // Initialize when document is ready
    document.addEventListener('DOMContentLoaded', function() {

        // Setup event card interactions
        setupEventCardInteractions();

        // Setup scroll animations
        setupScrollAnimations();

        // Add click animation to buttons
        document.querySelectorAll('.btn-animated').forEach(btn => {
            btn.addEventListener('click', function() {
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 200);
            });
        });
    });
</script>